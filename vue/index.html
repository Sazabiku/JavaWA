<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>MCST Vendor</title>

    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://unpkg.com/vue-router@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"></script>
    <script src="https://unpkg.com/buefy/dist/components/table"></script>
    <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
    <div id="app">
        <router-view></router-view>
    </div>
    <script>
        const productsComponent = {
            template:  `<div v-if="loading">Loading...</div>
                        <div v-else>
                            <div class="table">
                                <div class="caption"><h1>Product List</h1></div>
                                <div class="app">
                                    <table border="1">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Name</th>
                                            </tr>
                                        </thead>
                                        <tbody v-for="product in products">
                                            <tr>
                                                <td>{{product.id}}</td>
                                                <td>{{product.name}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div>
                                    <button class="button" v-on:click="addProduct">Add</button>
                                    <button class="button" v-on:click="deleteProduct">Delete</button>
                                    <button class="button" v-on:click="editProduct">Change</button>
                                </div>
                            </div>
                        </div>`,
            data() {
                return {
                    loading: true,
                    products: null,
                };
            },
            methods: {
                addProduct: function (event) {
                    this.$router.push('/addProduct');
                },
                deleteProduct: function (event) {
                    this.$router.push('/deleteProduct');
                },
                editProduct: function (event) {
                    this.$router.push('/editProduct');
                }
            },
            mounted() {
                axios
                    .get('http://localhost:8080/products', {mode: 'no-cors'})
                    .then(response => (this.products = response.data))
                    .finally(() => this.loading = false);
            }
        }
        const addProductComponent = {
            template: `<div>
                            <div class="add-form">
                                <div class="title caption"><h1>Product addition form</h1></div>
                                <section>
                                    <div>
                                        <div><input type="text" v-model="product.id" placeholder="Number"></div>
                                    </div>
                                    <div><input type="text" v-model="product.name" placeholder="Name"></div>
                                </section>
                            </div>
                            <div class="button-container">
                                <div class="buttons">
                                    <div>
                                        <button class="button" v-on:click="addProduct">Save changes</button>
                                        <button class="button" v-on:click="cancel">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>`,
            data() {
                return {
                    product: {
                        id: null,
                        name: null
                    }
                };
            },
            methods: {
                addProduct: function (event) {
                    axios.post('http://localhost:8080/products', JSON.stringify(this.product), {headers:{'Content-Type': 'application/json; charset=utf-8'}})
                        .then(response => {
                            console.log("product added");
                            this.$router.push('/products');
                        })
                        .catch(error => {
                            alert(error);
                        });
                },
                cancel: function (event) {
                    this.$router.push('/products')
                }
            }
        }
        const deleteProductComponent = {
            template: `<div>
                            <div class="delete-form">
                                <div class="title caption"><h1>Product deletion form</h1></div>
                                <section>
                                    <div>
                                        <div><input type="text" v-model="product.id" placeholder="Number"></div>
                                    </div>
                                </section>
                            </div>
                            <div class="button-container">
                                <div class="buttons">
                                    <div>
                                        <button class="button" v-on:click="deleteProduct">Delete</button>
                                        <button class="button" v-on:click="cancel">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>`,
            data() {
                return {
                    product: {
                        id: null,
                        name: null
                    }
                };
            },
            methods: {
                deleteProduct: function (event) {
                    const URL = 'http://localhost:8080/products/' + this.product.id;
                    axios.delete(URL, {headers:{'Content-Type': 'charset=utf-8'}})
                        .then(response => {
                            console.log("product deleted");
                            this.$router.push('/products');
                        })
                        .catch(error => {
                            alert(error);
                        });
                },
                cancel: function (event) {
                    this.$router.push('/products')
                }
            }
        }
        const editProductComponent = {
            template:  `<div>
                            <div class="edit-form">
                                <div class="title caption"><h1>Product alteration from</h1></div>
                                <section>
                                    <div>
                                        <div><input type="text" v-model="product.id" placeholder="Number"></div>
                                        <div><input type="text" v-model="product.name" placeholder="New name"></div>
                                    </div>
                                </section>
                            </div>
                            <div class="button-container">
                                <div class="buttons">
                                    <div>
                                        <button class="button" v-on:click="editProduct">Change</button>
                                        <button class="button" v-on:click="cancel">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>`,
            data() {
                return {
                    product: {
                        id: null,
                        name: null
                    }
                };
            },
            methods: {
                editProduct: function (event) {
                    const URL = 'http://localhost:8080/products/' + this.product.id;
                    const name = { name: this.product.name };
                    axios.put(URL, this.product.name, {headers:{'Content-Type': 'application/json'}})
                        .then(response => {
                            console.log("product edited");
                            this.$router.push('/products');
                        })
                        .catch(error => {
                            alert(error);
                        });
                },
                cancel: function (event) {
                    this.$router.push('/products')
                }
            }
        }

        const NotFound = { template: '<p>Страница не найдена</p>' }

        const routes = [
            {path: "/", component: productsComponent},
            {path: "/products", component: productsComponent},
            {path: "/addProduct", component: addProductComponent},
            {path: "/deleteProduct", component: deleteProductComponent},
            {path: "/editProduct", component: editProductComponent}
        ]

        const router = new VueRouter.createRouter({
            history: VueRouter.createWebHashHistory(),
            routes
        })

        const app = Vue.createApp({})
        app.use(router)
        app.mount('#app')
    </script>
</body>
</html>
